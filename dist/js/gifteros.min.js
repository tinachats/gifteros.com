// Date and time functions .popover-toggle-icon
var today = new Date();
var hours = ("0" + today.getHours()).slice(-2);
var date = ("0" + today.getDate()).slice(-2);
var mnth = ("0" + today.getMonth()).slice(-2);
var year = today.getFullYear();
var day = new Array();
day[0] = 'Sunday';
day[1] = 'Monday';
day[2] = 'Tuesday';
day[3] = 'Wednesday';
day[4] = 'Thursday';
day[5] = 'Friday';
day[6] = 'Saturday';

var d = day[today.getDay()];

var month = new Array();
month[0] = 'January';
month[1] = 'February';
month[2] = 'March';
month[3] = 'April';
month[4] = 'May';
month[5] = 'June';
month[6] = 'July';
month[7] = 'August';
month[8] = 'September';
month[9] = 'October';
month[10] = 'November';
month[11] = 'December';

// Owl Carousel navigation icons
const prevIcon = '<img src="dist/images/app/circled-previous.svg" class="prev-icon" alt="Prev" height="40" width="40">';
const nextIcon = '<img src="dist/images/app/circled-next.svg" class="next-icon" alt="Next" height="40" width="40">';

// Alert messages
var message = '';

// Array of acceptible files
var acceptible_files = ['gif', 'jfif', 'png', 'jpg', 'jpeg'];

// Cart details
var gift_id, post_id, user_id, gift_name, gift_image, total_price;
var gift_quantity = 1;
var gift_ids = [];

// Gift that have to be checked to see if color is chosen
var most_gifts = [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 21, 26, 27, 28, 30, 33, 35];

// Saving custom changes  to localStorage
var custom_change = [];
var customizations = new Object();

// Save the gift_id in the customization object
customizations.gift_id = gift_id;

// Comparison pane
var comparison_pane = document.querySelector('.comparisons-wrapper');

// Toggle sign-in form
function showLoginForm() {
    $('.user-menu').toggleClass('show');
}

// User greeting
(function greeting() {
    var greeting, icon;
    if (hours < 12) {
        greeting = 'Good morning!';
        icon = 'sunrise';
    } else if (hours < 18) {
        greeting = 'Good afternoon!';
        icon = "noon";
    } else {
        greeting = 'Good evening!'
        icon = 'cloudy-night';
    }
    $('.user-greeting').html(greeting);
    $('.greeting-icon').attr('src', `dist/images/greeting-icons/${icon}.svg`);
})();

// Toggle Search Bar
function toggleSearchBar() {
    $('#mobile-top-nav').toggleClass('d-none');
    $('#mobile-search-bar').toggleClass('d-none');
}

// Toggle Product Reviews
function toggleReviews() {
    $('#product-review-section').toggleClass('show');
    progressBarAnimation();
}

// RateYo Star Rating
function starRating(el, rating, size) {
    $(el).rateYo({
        rating: rating,
        starWidth: `${size}px`,
        spacing: '5px',
        readOnly: true
    });
}
// Force numeric input
function forceNumeric() {
    var input = $(this);
    input.val(input.val().replace(/[^\d+(\.\d{1,2})?$]+/, ''));
}

// Available colors
function availableColors() {
    var custom_colors = icon_color = '';
    var colors = [{
            'bg_color': 'bg-yellow-gold',
            'title': 'Yellow Gold'
        },
        {
            'bg_color': 'bg-orange-bright',
            'title': 'Bright Orange'
        },
        {
            'bg_color': 'bg-brick-red',
            'title': 'Brick Red'
        },
        {
            'bg_color': 'bg-red',
            'title': 'Red'
        },
        {
            'bg_color': 'bg-aqua',
            'title': 'Aqua'
        },
        {
            'bg_color': 'bg-orchid',
            'title': 'Violet'
        },
        {
            'bg_color': 'bg-default-blue',
            'title': 'Blue'
        },
        {
            'bg_color': 'bg-navy-blue',
            'title': 'Navy Blue'
        },
        {
            'bg_color': 'bg-turf-green',
            'title': 'Turf Green'
        },
        {
            'bg_color': 'bg-green',
            'title': 'Dark Green'
        },
        {
            'bg_color': 'bg-yellow-gold',
            'title': 'Yellow Gold'
        },
        {
            'bg_color': 'bg-dark',
            'title': 'Black'
        },
        {
            'bg_color': 'bg-brown',
            'title': 'Brown'
        },
        {
            'bg_color': 'bg-gray',
            'title': 'Dark Grey'
        },
        {
            'bg_color': 'bg-grey',
            'title': 'Grey'
        },
        {
            'bg_color': 'bg-white',
            'title': 'White'
        }
    ];
    colors.forEach(color => {
        if (color.bg_color == 'bg-white' || color.bg_color == 'bg-grey') {
            icon_color = 'text-success';
        } else {
            icon_color = 'text-white';
        }
        custom_colors += `
            <!-- Custom Color Picker -->
            <div class="custom-color available-color shadow-sm" id="${color.bg_color}" data-color="${color.title}" title="${color.title}">
                <div class="color-inset ${color.bg_color}">
                    <i class="${icon_color} material-icons color-selected-icon">done</i>
                </div>
            </div>
            <!-- Custom Color Picker -->
        `;
    });
    $('.available-colors').html(custom_colors);
}

// Shoe sizes
function shoeSizes(gift_id) {
    var output = '';
    for (var i = 35; i < 49; i++) {
        output += `
            <div class="d-grid shoe-size custom-option shoe-size" id="${i}${gift_id}" data-size="${i}">
                <div class="m-auto">
                    <div class="m-auto">
                        <span class="size">${i}</span>
                    </div>
                </div>
            </div> 
        `;
    }
    $('.shoe-sizes').html(output);
}

// Shirt sizes
function shirtSizes(gift_id) {
    var output = '';
    sizes = [
        { 'size': 'S' },
        { 'size': 'M' },
        { 'size': 'L' },
        { 'size': 'XL' },
        { 'size': 'XXL' },
        { 'size': 'XXXL' },
        { 'size': '4XL' }
    ];
    sizes.forEach(size => {
        output += `
            <div class="d-grid shirt-size custom-option ${size.size}" id="${size.size}${gift_id}" data-size="${size.size}">
                <div class="m-auto">
                    <span class="size">${size.size}</span>
                </div>
            </div>
        `;
    });
    $('.shirt-sizes').html(output);
}

// Bed sizes
function bedSizes() {
    var output = '';
    var bed_sizes = [
        { 'size': 'twin' },
        { 'size': 'twin-xl' },
        { 'size': 'double' },
        { 'size': 'queen' },
        { 'size': 'king' },
        { 'size': 's-king' }
    ];
    bed_sizes.forEach(bed_size => {
        output += `
            <div class="d-grid beds custom-option" id="${bed_size.size}${gift_id}" data-size="${bed_size.size}">
                <div class="m-auto">
                    <span class="size">${bed_size.size}</span>
                </div>
            </div>
        `;
    });
    $('.bed-sizes').html(output);
}

// Custom options
function customOptions(gift_id) {
    availableColors();
    shirtSizes(gift_id);
    bedSizes();
    shoeSizes(gift_id);
    ratingFilterBtns();
}

// Review Filter Buttons
function ratingFilterBtns() {
    var output = '';
    for (var i = 5; i > 0; i--) {
        output += `
            <div type="button" class="button btn btn-outline-secondary btn-sm filter-reviews filter-rating text-sm" data-id="${i}">
                ${i}<span class="text-gold">&starf;</span>
            </div>
        `;
    }
    $('#rating-filter-buttons').html(output);
}

/*** Preloaders ***/
function productPreloaders(limit) {
    var output = '';
    for (var i = 0; i < limit; i++) {
        output += `
            <!-- Product Placeholder Card -->
            <div class="card placeholder-card bg-whitesmoke rounded-2 box-shadow-sm">
                <div class="overlay-placeholder"></div>
                <div class="img-wrapper-placeholder">
                    <div class="badge customize-ribbon d-flex align-items-center placeholder-label rounded-end"></div>
                    <div class="placeholder-img"></div>
                </div>
                <hr class="grid-view-hr my-0 py-0">
                <div class="placeholder-card-content">
                    <div class="card-body placeholder-body m-0 p-0 rounded-bottom-2">
                        <div class="content-placeholder title-placeholder mt-1 ms-2"></div>
                        <div class="content-placeholder category-placeholder my-1 ms-2"></div>
                        <div class="d-flex align-items-center">
                            <div class="content-placeholder rating-placeholder ms-2"></div>
                        </div>
                        <div class="content-placeholder description-placeholder mt-2 mb-1 mx-2"></div>
                        <div class="content-placeholder half-description-placeholder ms-2"></div>
                        <div class="d-flex align-items-center justify-content-between placeholder-pricing-block mt-2">
                            <div class="content-placeholder price-placeholder me-2 ms-2"></div>
                            <div class="content-placeholder before-price-placeholder me-2"></div>
                        </div>
                        <div class="text-center w-100 mx-0 px-0 mb-1">
                            <div class="btn-group btn-group-sm mt-0 pt-0 btn-group-placeholder pulse">
                                <button class="btn btn-sm btn-cart-placeholder rounded-start"></button>
                                <button class="btn btn-sm compare-btn-placeholder rounded-end"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.Product Placeholder Card -->
        `;
    }
    $('#preloaders').html(output);
}
/*** /.Preloaders ***/

/*** Alerts ***/
// General info alert
function infoAlert(message) {
    iziToast.show({
        theme: 'dark',
        timeout: 5000,
        closeOnClick: true,
        close: false,
        progressBar: false,
        backgroundColor: 'var(--dark-blue)',
        icon: 'bi bi-info-circle text-white-inverse',
        message: message,
        messageColor: 'var(--white-inverse)',
        position: 'topCenter'
    });
}

// SweetAlert2 success
function swalSuccess(message) {
    Swal.fire(
        '',
        message,
        'success',
    );
}

// General success alert message
function successAlert(message) {
    iziToast.show({
        theme: 'dark',
        timeout: 2000,
        closeOnClick: true,
        overlay: false,
        close: false,
        backgroundColor: 'var(--success)',
        progressBar: false,
        icon: 'bi bi-check2-circle text-light',
        message: message,
        messageColor: '#fff',
        position: 'topCenter'
    });
}

// Success alert message with gift image
function giftSuccessAlert(gift_image, message) {
    iziToast.show({
        animateInside: true,
        theme: 'dark',
        timeout: 3000,
        closeOnClick: true,
        overlay: false,
        close: false,
        backgroundColor: 'var(--success)',
        progressBar: false,
        icon: 'bi bi-check2-circle text-light',
        image: `dist/images/gifts/${gift_image}`,
        imageWidth: 60,
        message: message,
        messageColor: '#fff',
        position: 'topCenter'
    });
}

// General warning alert
function warningAlert(message) {
    iziToast.warning({
        theme: 'dark',
        timeout: 5000,
        closeOnClick: true,
        close: false,
        progressBar: false,
        backgroundColor: 'var(--warning)',
        icon: 'bi bi-exclamation-circle text-dark',
        message: message,
        messageColor: '#000',
        position: 'topCenter'
    });
}

// SweetAlert2 pop-up question
function deleteQstn(title, message, btnText, el, id) {
    Swal.fire({
        title: title,
        text: message,
        icon: 'question',
        backdrop: 'swal2-backdrop-show',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: btnText
    }).then((result) => {
        if (result.value) {
            removeItem(el, id);
        }
    });
}
/*** /.Alerts ***/


/*** Details Page Actions ***/

// Fetch all gift customized details
function customizationDetails(gift_id) {
    let data = localStorage.getItem('customized-gifts');
    var custom_color = custom_text = bed_size = '';
    var shirt_size = shoe_size = '';
    if (data != null) {
        var custom_changes = JSON.parse(localStorage.getItem('customized-gifts'));
        for (var i = 0; i < custom_changes.length; i++) {
            if (custom_changes[i].gift_id == gift_id) {
                custom_color = custom_changes[i].custom_color;
                bed_size = custom_changes[i].bed_size;
                shirt_size = custom_changes[i].shirt_size;
                shoe_size = custom_changes[i].shoe_size;
                custom_text = custom_changes[i].custom_text;
            }
        }
        // Show active available color on the page
        $('.available-color').not(this).removeClass('active');
        $(`#${available_color}${gift_id}`).addClass('active');

        // Show active custom-color on the page
        $('.custom-color').not(this).removeClass('active');
        $(`#${custom_color}${gift_id}`).addClass('active');

        // Show active bed-size on the page
        $('.beds').not(this).removeClass('active');
        $(`#${bed_size}${gift_id}`).addClass('active');

        // Show active shoe-size on the page
        $('.shoe-size').not(this).removeClass('active');
        $(`#${shoe_size}${gift_id}`).addClass('active');

        // Show active shirt-size on the page
        $('.shirt-size').not(this).removeClass('active');
        $(`#${shirt_size}${gift_id}`).addClass('active');

        // Show custom text
        $('#gift-custom-text').text(custom_text);
        $('#user-custom-gift-text').val(custom_text);
    } else {
        $('.shirt-size').removeClass('active');
        $('.custom-option').removeClass('active');
        $('.beds').removeClass('active');
    }
}

function smallSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">92cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">64cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">43cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">17cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function mediumSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">96cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">65cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">44cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">18cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function largeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">100cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">67cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">46cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">19cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function xlargeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">104cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">69cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">47cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">20cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function xxlargeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">108cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">71cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">50cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">21cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function xxxlargeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">110cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">73cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">54cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">22cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function xxxxlargeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">112cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">75cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">57cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">23cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

// Diable the submit button if there's no review text
function emptyReview(obj) {
    var review = obj.value;
    if (review.length > 0) {
        $('#submit-review').attr('disabled', false);
    } else {
        $('#submit-review').attr('disabled', true);
    }
}

// Popover rating info
function popoverRating() {
    var output = `
        <!-- Gift Rating Metrics -->
        <div class="flex-column justify-content-center w-100 text-center mt-2">
            <!-- Rating Stats -->
            <div class="d-block text-center position-relative">
                <h5 class="display-5 text-color-switch my-0 py-0 font-600">4.5</h5>
                <ul class="list-inline m-0 p-0">
                    <li class="list-inline-item lead-2x py-0 my-0 text-gold">&starf;</li>
                    <li class="list-inline-item lead-2x py-0 my-0 text-gold">&starf;</li>
                    <li class="list-inline-item lead-2x py-0 my-0 text-gold">&starf;</li>
                    <li class="list-inline-item lead-2x py-0 my-0 text-gold">&starf;</li>
                    <li class="list-inline-item lead-2x py-0 my-0 text-muted">&starf;</li>
                </ul>
                <div class="d-flex align-items-center justify-content-center mb-1">
                    <i class="bi bi-people-fill icon-md text-muted pull-up-1 me-1"></i>
                    <h6 class="text-muted text-center my-0 py-0">1233 total reviews</h6>
                </div>
            </div>
            <!-- /.Rating Stats -->

            <!-- Progress Bar Rating -->
            <div class="flex-column text-center w-100" id="progress-rating">
                <div class="flex-column progress-bars">
                    <!-- Five Star Rating -->
                    <div class="progress-bar-rating d-flex align-items-center">
                        <ul class="list-inline gift-star-rating m-0 p-0">
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                        </ul>
                        <div class="progress progess-sm w-100 mx-2">
                            <div class="progress-bar bg-gold" role="progressbar" aria-valuemin="0" aria-valuenow="12" aria-valuemax="100" style="width:12%;">
                                <span class="text-white font-400">12%</span>
                            </div>
                        </div>
                        <span class="percentage text-sm">12%</span>
                    </div>
                    <!-- /.Five Star Rating -->

                    <!-- Four Star Rating -->
                    <div class="progress-bar-rating d-flex align-items-center">
                        <ul class="list-inline gift-star-rating m-0 p-0">
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                        </ul>
                        <div class="progress progess-sm w-100 mx-2">
                            <div class="progress-bar bg-gold" role="progressbar" aria-valuemin="0" aria-valuenow="19" aria-valuemax="100" style="width:19%;">
                                <span class="text-white font-400">19%</span>
                            </div>
                        </div>
                        <span class="percentage text-sm">19%</span>
                    </div>
                    <!-- /.Four Star Rating -->

                    <!-- Three Star Rating -->
                    <div class="progress-bar-rating d-flex align-items-center">
                        <ul class="list-inline gift-star-rating m-0 p-0">
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                        </ul>
                        <div class="progress progess-sm w-100 mx-2">
                            <div class="progress-bar bg-gold" role="progressbar" aria-valuemin="0" aria-valuenow="45" aria-valuemax="100" style="width:45%;">
                                <span class="text-white font-400">45%</span>
                            </div>
                        </div>
                        <span class="percentage text-sm">45%</span>
                    </div>
                    <!-- /.Three Star Rating -->

                    <!-- Two Star Rating -->
                    <div class="progress-bar-rating d-flex align-items-center">
                        <ul class="list-inline gift-star-rating m-0 p-0">
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                        </ul>
                        <div class="progress progess-sm w-100 mx-2">
                            <div class="progress-bar bg-gold" role="progressbar" aria-valuemin="0" aria-valuenow="97" aria-valuemax="100" style="width:97%;">
                                <span class="text-white font-400">97%</span>
                            </div>
                        </div>
                        <span class="percentage text-sm">97%</span>
                    </div>
                    <!-- /.Two Star Rating -->

                    <!-- One Star Rating -->
                    <div class="progress-bar-rating d-flex align-items-center">
                        <ul class="list-inline gift-star-rating m-0 p-0">
                            <li class="list-inline-item text-gold">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                            <li class="list-inline-item text-muted">&starf;</li>
                        </ul>
                        <div class="progress progess-sm w-100 mx-2">
                            <div class="progress-bar bg-gold" role="progressbar" aria-valuemin="0" aria-valuenow="58" aria-valuemax="100" style="width:58%;">
                                <span class="text-white font-400">58%</span>
                            </div>
                        </div>
                        <span class="percentage text-sm">58%</span>
                    </div>
                    <!-- /.One Star Rating -->
                </div>
            </div>
            <!-- /.Progress Bar Rating -->
            <a href="details.html" class="text-center mt-2 text-underline d-flex align-items-center justify-content-center">
                See more reviews <i class="bi bi-chevron-right ms-2"></i>
            </a>
        </div>
        <!-- /.Gift Rating Metrics -->
    `;
    return output;
}

// Rating category
function ratingCategory(rating) {
    var output = '';
    if (rating >= 0 && rating < 1.5) {
        output = 'Very Bad';
    } else if (rating >= 1.5 && rating < 2.5) {
        output = 'Bad';
    } else if (rating >= 2.5 && rating < 3.5) {
        output = 'Fair';
    } else if (rating >= 3.5 && rating < 4.5) {
        output = 'Good';
    } else {
        output = 'Awesome';
    }
    return output;
}

function imageZoom(imgID, resultID) {
    var img, lens, result, cx, cy;
    img = document.getElementById(imgID);
    result = document.getElementById(resultID);
    /* Create lens: */
    lens = document.createElement("DIV");
    lens.setAttribute("class", "img-zoom-lens");
    /* Insert lens: */
    img.parentElement.insertBefore(lens, img);
    /* Calculate the ratio between result DIV and lens: */
    cx = result.offsetWidth / lens.offsetWidth;
    cy = result.offsetHeight / lens.offsetHeight;
    /* Set background properties for the result DIV */
    result.style.backgroundImage = "url('" + img.src + "')";
    result.style.backgroundSize = (img.width * cx) + "px " + (img.height * cy) + "px";
    /* Execute a function when someone moves the cursor over the image, or the lens: */
    lens.addEventListener("mousemove", moveLens);
    img.addEventListener("mousemove", moveLens);
    /* And also for touch screens: */
    lens.addEventListener("touchmove", moveLens);
    img.addEventListener("touchmove", moveLens);

    function moveLens(e) {
        var pos, x, y;
        /* Prevent any other actions that may occur when moving over the image */
        e.preventDefault();
        /* Get the cursor's x and y positions: */
        pos = getCursorPos(e);
        /* Calculate the position of the lens: */
        x = pos.x - (lens.offsetWidth / 2);
        y = pos.y - (lens.offsetHeight / 2);
        /* Prevent the lens from being positioned outside the image: */
        if (x > img.width - lens.offsetWidth) { x = img.width - lens.offsetWidth; }
        if (x < 0) { x = 0; }
        if (y > img.height - lens.offsetHeight) { y = img.height - lens.offsetHeight; }
        if (y < 0) { y = 0; }
        /* Set the position of the lens: */
        lens.style.left = x + "px";
        lens.style.top = y + "px";
        /* Display what the lens "sees": */
        result.style.backgroundPosition = "-" + (x * cx) + "px -" + (y * cy) + "px";
    }

    function getCursorPos(e) {
        var a, x = 0,
            y = 0;
        e = e || window.event;
        /* Get the x and y positions of the image: */
        a = img.getBoundingClientRect();
        /* Calculate the cursor's x and y coordinates, relative to the image: */
        x = e.pageX - a.left;
        y = e.pageY - a.top;
        /* Consider any page scrolling: */
        x = x - window.pageXOffset;
        y = y - window.pageYOffset;
        return { x: x, y: y };
    }
}

function progressBarAnimation() {
    $('.progress-bar').each(function() {
        var $this = $(this);
        var per = $(this).attr('aria-valuenow');
        $this.animate({
            width: `${per}%`,
            step: function() {
                $(this).attr('aria-valuenow', Math.floor(per) + '%');
            },
            complete: function() {
                $(this).attr('aria-valuenow', Math.floor(per) + '%');
            }
        }, 5000);
    });
}
/*** /.Details Page Actions ***/

/*** File Uploading and previewing ***/
//Click profile avatar placeholder to upload file
function triggerClick() {
    $('#profile-pic').on('click');
}

function displayImg(e) {
    if (e.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('.prof-pic').attr('src', e.target.result);
        }
        reader.readAsDataURL(e.files[0]);
    }
}
/*** /.File Uploading and previewing ***/

/*** App Settings ***/
function userTheme() {
    if ($('body').hasClass('darkmode')) {
        // Change the theme to default
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        $('.theme-switch').attr('checked', false);
        localStorage.setItem('theme', 'default');
    } else {
        // Change to darkmode
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'darkmode');
        $('.theme-mode').css('color', 'text-warning');
        $('.theme-switch').attr('checked', true);
    }
}

// Toggling between the dark and light mode
function themeMode(obj) {
    var darkmode = obj.checked;
    if (darkmode) {
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'darkmode');
        $('.theme-mode').css('color', 'text-warning');
        $('.theme-switch').attr('checked', true);
    } else {
        $('body').toggleClass('darkmode');
        $('.main-sidebar').toggleClass('bg-meshgrid');
        $('.settings-bar').toggleClass('bg-meshgrid');
        $('#day-mode').toggleClass('d-none');
        $('#night-mode').toggleClass('d-none');
        localStorage.setItem('theme', 'default');
        $('.theme-switch').attr('checked', false);
    }
}

// Displaying gifts according to user's preference
function viewOption() {
    let view_option = localStorage.getItem('view-option');
    if (view_option !== null) {
        if (view_option === 'grid-view') {
            $('.grid-icon').addClass('active');
            $('.list-icon').removeClass('active');
            if ($('.products-shelf').hasClass('grid-view') && ($('.gifts-preloader').hasClass('grid-view'))) {
                $('.products-shelf').removeClass('list-view');
                $('.gifts-preloader').removeClass('list-view');
            } else {
                $('.products-shelf').removeClass('list-view');
                $('.gifts-preloader').removeClass('list-view');
                $('.products-shelf').addClass('grid-view');
                $('.gifts-preloader').addClass('grid-view');
            }
        } else if (view_option === 'list-view') {
            $('.grid-icon').removeClass('active');
            $('.list-icon').addClass('active');
            if ($('.products-shelf').hasClass('list-view') && $('.gifts-preloader').hasClass('list-view')) {
                $('.products-shelf').removeClass('grid-view');
                $('.gifts-preloader').removeClass('grid-view');
            } else {
                $('.products-shelf').removeClass('grid-view');
                $('.gifts-preloader').removeClass('grid-view');
                $('.products-shelf').addClass('list-view');
                $('.gifts-preloader').addClass('list-view');
            }
        }
    } else {
        $('.grid-icon').addClass('active');
        $('.list-icon').removeClass('active');
        $('.products-shelf').removeClass('list-view');
        $('.gifts-preloader').removeClass('list-view');
    }
}

// Fetch user's name ordering
function nameOrdering() {
    var name_ordering = localStorage.getItem('name-sorting-order');
    var name_sorting;
    if (name_ordering) {
        if (name_ordering == 'asc') {
            name_sorting = 'asc';
            $('#name-asc').attr('checked', true);
        } else {
            name_sorting = 'desc';
            $('#name-asc').attr('checked', false);
        }
    } else {
        name_sorting = 'asc';
    }
    return name_sorting;
}

// Toggling sorting gifts by their name order (ASC or DESC)
function orderByName(obj) {
    var asc = obj.checked;
    if (asc) {
        $('#name-sorting-order').text('Ascending');
        localStorage.setItem('name-sorting-order', 'asc');
    } else {
        $('#name-sorting-order').text('Descending');
        localStorage.setItem('name-sorting-order', 'desc');
    }
}

// Fetch user's price ordering
function priceOrdering() {
    var price_ordering = localStorage.getItem('price-sorting-order');
    var price_sorting;
    if (price_ordering) {
        if (price_ordering == 'asc') {
            price_sorting = 'asc';
            $('#price-sorting').val('asc');
            $('#price-ordering-label').text('Ascending');
            $('#price-ordering').attr('checked', true);
        } else {
            price_sorting = 'desc';
            $('#price-sorting').val('desc');
            $('#price-ordering-label').text('Descending');
            $('#price-ordering').attr('checked', false);
        }
    } else {
        price_sorting = 'asc';
    }
    return price_sorting;
}

// Toggling sorting gifts by their price order (ASC or DESC)
function orderByPrice(obj) {
    price_ordering = obj.checked;
    if (price_ordering) {
        $('#price-ordering-label').text('Ascending');
        localStorage.setItem('price-sorting-order', 'asc');
        location.reload();
    } else {
        $('#price-ordering-label').text('Descending');
        localStorage.setItem('price-sorting-order', 'desc');
        location.reload();
    }
}

// Products display style option
function displayOption(view_option) {
    if (view_option === 'grid-view') {
        if ($('.display-gifts').hasClass('grid-view') && $('.gifts-preloader').hasClass('grid-view')) {
            $('.display-gifts').removeClass('list-view');
            $('.gifts-preloader').removeClass('list-view');
        } else {
            $('.display-gifts').removeClass('list-view');
            $('.gifts-preloader').removeClass('list-view');
            $('.display-gifts').addClass('grid-view');
            $('.gifts-preloader').addClass('grid-view');
        }

        $('.list-icon').removeClass('active');
        $('.grid-icon').addClass('active');

    } else if (view_option === 'list-view') {
        if ($('.display-gifts').hasClass('list-view') && $('.gifts-preloader').hasClass('list-view')) {
            $('.display-gifts').removeClass('grid-view');
            $('.gifts-preloader').removeClass('grid-view');
        } else {
            $('.display-gifts').removeClass('grid-view');
            $('.gifts-preloader').removeClass('grid-view');
            $('.display-gifts').addClass('list-view');
            $('.gifts-preloader').addClass('list-view');
        }
        $('.grid-icon').removeClass('active');
        $('.list-icon').addClass('active');
    }
}

// Scroll to top of the page
function scrollToTop() {
    $('html, body').animate({
        scrollTop: 0
    }, 1000);
}

// Sale countdown timer
(function countdownTimer(countdown_date, now) {
    countdown_date = new Date('Mar 19, 2021 00:00:00').getTime();
    now = today.getTime();
    // Update the countdown every second
    var x = setInterval(() => {
        now += 1000;

        // Find the difference between now and the countdown date
        var diff = countdown_date - now;

        // Time calculation for days, hours, minutes and seconds
        var days = Math.floor(diff / (1000 * 60 * 60 * 24));
        var hrs = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        var secs = Math.floor((diff % (1000 * 60)) / 1000);

        // Add a zero (0) prefix if below 10
        days = ('0' + days).slice(-2);
        hrs = ('0' + hrs).slice(-2);
        mins = ('0' + mins).slice(-2);
        secs = ('0' + secs).slice(-2);

        // Output the result in the gifts countdown-timer
        $('.countdown-timer').html(`${days}d:${hrs}h:${mins}m:${secs}s`);

        // Display that the sale is offer
        if (diff < 0) {
            clearInterval(x);
            $('.countdown-timer').addClass('text-danger');
            $('.sale-icon').html('alarm_off');
        }
    }, 1000);
})();
/*** /.App Settings ***/

/*** Cart Actions ***/
// Add an item into the cart
function addToCart(gift_id, item_count) {
    item_count += 1;
    $(`#gift-item-count${gift_id}`).text(item_count);
    $(`#quantity-input${gift_id}`).val(item_count);
}

// Subtract an item from the cart
function subtractFromCart(gift_id, item_count) {
    item_count -= 1;
    if (item_count <= 0) {
        item_count = 0;
    }
    $(`#gift-item-count${gift_id}`).text(item_count);
    $(`#quantity-input${gift_id}`).val(item_count);
    $(`#cart-options${gift_id}`).removeClass('d-none');
}

// Remove an item from the cart
function removeItem(el, id) {
    $(`${el}${id}`).parent().remove();
}
/*** /.Cart Actions ***/

/*** Comparison Actions ***/
// Close comparison pane
function closePanel() {
    $('.compare-btn').children(':first').removeClass('fa-check');
    $('.compare-btn').children(':first').addClass('fa-exchange');
    $('.comparison-pane').hide();
}

// Loop through all filled product-panes to enable the submit button
function comparisons() {
    var items = $('.filled');
    if (items.length >= 0) {
        for (var i = 0; i < items.length; i++) {
            if (i == 0) {
                $('.comparison-pane').removeClass('d-none');
            } else if (i == 1) {
                $('#submit-comparisons').removeClass('d-none');
            } else if (i >= 2) {
                infoAlert('Only max. 3 comparisons allowed');
            } else {
                closePanel();
            }
        }
    } else {
        closePanel();
    }
}

// Remove comparison item from the product pane
function removeComparison(gift_id, comparison_pane) {
    // Replace the comparison-item pane with the placeholder-pane
    var comparison_item = document.querySelector('#comparison-item' + gift_id);
    const placeholder_pane = document.createElement('div');
    placeholder_pane.classList = `
        comparison-item empty d-block bg-transparent rounded-2 border-dashed 
        box-shadow-sm d-grid p-2
    `;
    placeholder_pane.innerHTML = `
        <div class="m-auto">
            <div class="d-block text-center">
                <i class="bi bi-plus text-white fa-2x"></i>
                <h6 class="font-600 text-white">Add an item to compare</h6>
            </div>
        </div>
    `;
    comparison_pane.replaceChild(placeholder_pane, comparison_item);
}
/*** /.Comparison Actions ***/

$(function() {
    // Enable popovers and tooltips
    $('[data-bs-toggle="popover"]').popover();
    $('[data-bs-toggle="tooltip"]').tooltip();

    // Load material-icons
    $('.material-icons').show();

    // Hide the progress gradient when page is fully loaded
    $('.line').hide();

    //Alert Tone
    function alert_tone() {
        var tone = '<audio autoplay="true"><source src="../tones/alert.wav"></audio>';
        $('body').append(tone);
    }

    // Toggle scroll to top button
    $(window).on('scroll', function() {
        if ($(this).scrollTop() - 200 > 0) {
            // Show button
            $('.to-top').stop().addClass('show');
        } else {
            // Hide button
            $('.to-top').stop().removeClass('show');
        }
    });

    // Toggle the side-menu
    $('.toggle-side-menu').on('click', function() {
        $('.main-sidebar').addClass('show');
        $('.app-backdrop').removeClass('d-none');
    });

    // Close the sidebar if user clicks outside the navbar
    $(document).on('mouseup', function(e) {
        var sidebar = $('.main-sidebar');
        if (sidebar.hasClass('show')) {
            if (!sidebar.is(e.target) && sidebar.has(e.target).length == 0) {
                $('.main-sidebar').removeClass('show');
                $('.app-backdrop').addClass('d-none');
            } else {
                $('.main-sidebar').addClass('show');
                $('.app-backdrop').removeClass('d-none');
            }
        }
    });

    // Toggle active class on category list-items
    $('.categories-list>.nav-item').on('click', function(e) {
        e.preventDefault();
        $(this).addClass('active');
        $('.categories-list>.nav-item').not(this).removeClass('active');
    });

    // Toggle the active class on side-menu-items
    $('.side-menu-item').on('click', function() {
        $(this).addClass('active');
        $('.side-menu-item').not(this).removeClass('active');
    });

    // Toggle Main Menu in Sidebar-menu
    $('.toggle-main-menu').on('click', function() {
        if ($('#sidebar-main-menu').hasClass('d-none')) {
            $('#sidebar-main-menu').removeClass('d-none');
            $('.sidebar-menu').not('#sidebar-main-menu').addClass('d-none');
        }
    });

    // Toggle Departments in Sidebar-menu
    $('.toggle-departments').on('click', function() {
        if ($('#categories-menu').hasClass('d-none')) {
            $('#categories-menu').removeClass('d-none');
            $('.sidebar-menu').not('#categories-menu').addClass('d-none');
        }
    });

    // Toggle Sub-Categories in Sidebar-menu
    $('.toggle-category-menu').on('click', function() {
        var category_name = $(this).data('category');
        $('#sidemenu-category-name').html(category_name);
        if ($('#category-menu').hasClass('d-none')) {
            $('#category-menu').removeClass('d-none');
            $('.sidebar-menu').not('#category-menu').addClass('d-none');
        }
    });

    // Change profile picture
    $(document).on('change', '#profile-pic', function(e) {
        e.stopPropagation();
        var property = this.files[0];
        var profile_pic = property.name;
        var ext = profile_pic.split('.').pop().toLowerCase();
        if ($.inArray(ext, acceptible_files) == -1) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            message = 'Oops! Image file type not allowed!';
            warningAlert(message);
        }
        var img_size = property.size;
        if (img_size > 2000000) {
            $('.line').css('display', 'block');
            setTimeout(() => {
                $('.line').css('display', 'none');
            }, 5000);
            message = 'Oops! Image file too large!';
            warningAlert(message);
        } else {
            $('.line').css('display', 'none');
            var form_data = new FormData();
            form_data.append('profile-pic', property);
            // Ajax call here
        }
    });

    // Click to toggle floating-action-buttons
    $(document).on('click', '.toggle-actions', function() {
        $('.action-btn').toggleClass('show');
    });

    // Force numeric values on text inputs
    $('body').on('keyup', '.number-input', forceNumeric);

    // Gift search suggestions
    $(document).on('keyup', '#search', function() {
        let search = $(this).val();
        let val = search.length;
        if (val > 0) {
            $(this).addClass('expanded');
            $('.zoom-out-section').css('z-index', -1);
            $('.search-list').removeClass('d-none');
            $.ajax({
                url: '/search',
                method: 'get',
                data: {
                    search: search
                },
                dataType: 'json',
                success: function(data) {
                    $('.search-list').html(data.results);
                    userCurrency();
                }
            });
        } else {
            $(this).removeClass('expanded');
            $('.zoom-out-section').css('z-index', 'initial');
            $('.line').css('display', 'none');
            $('.search-list').addClass('d-none');
        }
    });

    // Close the search list if not in focus
    $(document).on('mouseup', function(e) {
        var search_list = $('.search-list');
        if (!search_list.is(e.target) && search_list.has(e.target).length == 0) {
            $('.search-list').addClass('d-none');
            $('.zoom-out-section').css('z-index', 'initial');
            $('#search-form')[0].reset();
            $('#search').removeClass('expanded');
        }
    });

    // Do not close app-menu when clicked inside
    $('.app-menu').on('click', function(e) {
        e.stopPropagation();
    });

    // Close sign-in form if not in focus
    $(document).on('mouseup', function(e) {
        var login_form = $('.user-menu');
        if (!login_form.is(e.target) && login_form.has(e.target).length == 0) {
            $('.user-menu').removeClass('show');
        }
    });

    // Progress bar animation
    progressBarAnimation();

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.getElementsByClassName('needs-validation');
    // Loop over them and prevent submission
    Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });

    //Get the button
    $(window).on('scroll', function() {
        if ($(document).height() >= $(window).height()) {
            $('#scroll-top').css('display', 'block');
        } else {
            $('#scroll-top').css('display', 'none');
        }
    });

    // Toggle the active class on the nav-icon
    $(document).on('click', function(e) {
        var icon_links = $('.icon-link');
        if (!icon_links.is(e.target) && icon_links.has(e.target).length == 0) {
            icon_links.removeClass('active');
        }
    });

    // Show the mega-menu on mouse-enter
    $('.mega-item').on('mouseenter', function(e) {
        $('.zoom-out-section').css('z-index', -1);
        $('.mega-menu').toggleClass('show');
    });

    $('.mega-item').on('mouseleave', function(e) {
        $('.zoom-out-section').css('z-index', 'initial');
        $('.mega-menu').toggleClass('show');
    });

    // Choose currency
    $('.currency-option').on('click', function() {
        var currency_flag = $(this).children(':first').attr('src');
        var currency = $(this).children(':last').attr('id');
        var total = $(this).children(':last').data('total')
        $('#currency-flag').attr('src', currency_flag);
        $('#currency-total').html(total);
    });

    // Toggling view-options
    $('.view-option').on('click', function() {
        var view_option = $(this).data('view');
        displayOption(view_option);
        // Save the user's option in local storage
        localStorage.setItem('view-option', view_option);
    });

    $('.view-option-button').on('click', function() {
        var view_option = $(this).data('view');
        if (view_option == 'grid-view') {
            $(this).toggleClass('d-none');
            $('.list-view-btn').toggleClass('d-none');
        } else {
            $(this).toggleClass('d-none');
            $('.grid-view-btn').toggleClass('d-none');
        }
        displayOption(view_option);
        // Save the user's option in local storage
        localStorage.setItem('view-option', view_option);
    });

    // Toggle settings sidebar
    $('.toggle-settings').on('click', function(e) {
        e.stopPropagation();
        $('.settings-bar').toggleClass('show');
        $('.app-backdrop').toggleClass('d-none');
    });

    // Close the settings bar if not in focus
    $(document).on('mouseup', function(e) {
        var settings_bar = $('.settings-bar');
        if (settings_bar.hasClass('show')) {
            if (!settings_bar.is(e.target) && settings_bar.has(e.target).length == 0) {
                $('.settings-bar').removeClass('show');
                $('.app-backdrop').addClass('d-none');
            }
        }
    });

    // Toggle filter panel
    $('.toggle-filters').on('click', function(e) {
        e.stopPropagation();
        $('.filter-panel').toggleClass('show');
        $('.app-backdrop').toggleClass('d-none');
    });

    // Close the filter panel if not in focus
    $(document).on('mouseup', function(e) {
        var filter_panel = $('.filter-panel');
        if (filter_panel.hasClass('show')) {
            if (!filter_panel.is(e.target) && filter_panel.has(e.target).length == 0) {
                $('.filter-panel').removeClass('show');
                $('.app-backdrop').addClass('d-none');
            }
        }
    });

    // Close fabs when not in focus
    $(document).on('mouseup', function(e) {
        var fabs = $('.fabs');
        if (!fabs.is(e.target) && fabs.has(e.target).length == 0) {
            $('.action-btn').removeClass('show');
        }
    });

    // Toggle collapse icon on click
    $('.collapse-link').on('click', function() {
        $(this).children(':first').toggleClass('bi-chevron-down');
        $(this).children(':first').toggleClass('bi-chevron-up');
    });

    // Toggle active class on review filters 
    $(document).on('click', '.filter-reviews', function() {
        $('.filter-reviews').not(this).removeClass('active');
        $(this).addClass('active');
    });

    // Toggle filter actions
    $('.filter-button').on('click', function() {
        $('.filter-button').not(this).removeClass('active');
        $(this).addClass('active');
    });

    // Show selected filter in dropdown button
    $('.review-filter-item').on('click', function() {
        var rating = $(this).data('id');
        if (rating == 'Most relevant') {
            $('#most-relevant-icon').removeClass('d-none');
            $('#newest-icon').addClass('d-none');
        } else {
            $('#most-relevant-icon').addClass('d-none');
            $('#newest-icon').removeClass('d-none');
        }
        $('#sort-reviews').text(rating);
    });

    // Show selected dropdown-menu item in button
    $('.filter-option-item').on('click', function() {
        var item_icon = $(this).children(':first').data('icon');
        var item_text = $(this).children(':last').html();
        $('.dropdown-menu-icon').toggleClass('fa-sort');
        $('.dropdown-menu-icon').toggleClass(item_icon);
        $('.dropdown-menu-text').html(item_text);
        $('.filter-button').not(this).removeClass('active');
        $('.dropdown-toggle.filter-button').addClass('active');
    });

    // Toggle harassment-type on click
    $('.report-radio-btn').on('click', function() {
        var report_type = $(this).val();
        if (report_type == 'harassment') {
            $('#harassment-type').removeClass('d-none');
        } else {
            $('#harassment-type').addClass('d-none');
        }
    });

    // Toggling payment method details
    $('.payment-method').on('click', function() {
        if ($(this).attr('id') == 'paynow') {
            $('#card-section').addClass('d-none');
            $('#paynow-section').removeClass('d-none');
        } else {
            $('#card-section').removeClass('d-none');
            $('#paynow-section').addClass('d-none');
        }
    });

    // Show gift info in popover
    $('.popover-info').popover({
        trigger: 'manual',
        html: true,
        animation: false,
        content: popoverRating,
        container: 'body',
        placement: 'bottom',
        sanitize: false
    }).on('mouseenter', function() {
        $(this).children(':first').toggleClass('bi-chevron-down');
        $(this).children(':first').toggleClass('bi-chevron-up');
        var _this = this;
        $(this).popover('show');
        $('.popover').on('mouseleave', function() {
            $(_this).popover('hide');
        });
    }).on('mouseleave', function() {
        $(this).children(':first').toggleClass('bi-chevron-down');
        $(this).children(':first').toggleClass('bi-chevron-up');
        var _this = this;
        setTimeout(function() {
            if (!$('.popover:hover').length) {
                $(_this).popover('hide');
            }
        }, 300);
    });

    // Toggling the active class on clicked menu items
    $('.nav-menu-item').on('click', function() {
        $(this).addClass('active');
        $('.nav-menu-item').not(this).removeClass('active');
    });

    // Adding or removing an item from the wishlist
    $('.wishlist-btn').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        gift_id = $(this).data('id');
        gift_image = $(`#hidden-gift-image${gift_id}`).val();
        var gift_wishlist_count = parseInt($(`#gift-wishlist-count${gift_id}`).text());
        var action = $(this).attr('id');
        if (action == 'wish') {
            gift_wishlist_count += 1;
            $(this).attr('id', 'unwish');
            giftSuccessAlert(gift_image, 'Added to your Wishlist');
        } else {
            gift_wishlist_count -= 1;
            $(this).attr('id', 'wish');
            giftSuccessAlert(gift_image, 'Removed from your Wishlist');
        }
        $(`#gift-wishlist-count${gift_id}`).text(gift_wishlist_count);
        $(this).children(':first').toggleClass('bi-heart');
        $(this).children(':first').toggleClass('bi-heart-fill');

        // Ajax code here
    });

    // Toggle Card Actions
    $('.toggle-card-actions').on('click', function(e) {
        e.preventDefault();
        gift_id = $(this).data('id');
        $(`#card-actions${gift_id}`).toggleClass('d-none');
        $('.card-actions').not(`#card-actions${gift_id}`).addClass('d-none');
    });

    // Adding an item to cart
    $('.add-to-cart-btn').on('click', function() {
        gift_id = $(this).data('id');
        var item_count = parseInt($(`#gift-item-count${gift_id}`).text());
        addToCart(gift_id, item_count);
    });

    $('.increase-qty').on('click', function() {
        gift_id = $(this).data('id');
        var item_count = parseInt($(`#quantity-input${gift_id}`).val());
        gift_price = parseFloat($(`#hidden-gift-price${gift_id}`).val());
        var total_price = ((item_count + 1) * gift_price).toFixed(2);
        $(`#gift-price${gift_id}`).text(total_price);
        addToCart(gift_id, item_count);
    });

    // Subtracting an item from the cart
    $('.subtract-product').on('click', function() {
        gift_id = $(this).data('id');
        var item_count = parseInt($(`#gift-item-count${gift_id}`).text());
        subtractFromCart(gift_id, item_count);
    });

    $('.decrease-qty').on('click', function() {
        gift_id = $(this).data('id');
        var item_count = parseInt($(`#quantity-input${gift_id}`).val());
        var qty = item_count - 1;
        gift_price = parseFloat($(`#hidden-gift-price${gift_id}`).val());
        if (qty > 1) {
            total_price = (qty * gift_price).toFixed(2);
        } else if (qty == 1) {
            total_price = gift_price;
        } else {
            removeItem('#wishlist-item', gift_id);
        }
        $(`#gift-price${gift_id}`).text(total_price);
        subtractFromCart(gift_id, item_count);
    });

    // Remove (del) an item from the cart
    $('.remove-item').on('click', function() {
        gift_id = $(this).data('id');
        var title = 'Remove from Wishlist?';
        var message = 'Are you sure that you want to remove this item from your Wishlist?';
        var btnText = 'Yes, I\'m sure';
        var el = '#wishlist-item';
        deleteQstn(title, message, btnText, el, gift_id);
    });


    // Adding a gift item for comparison
    $('.compare-btn').on('click', function() {
        $(this).children(':first').toggleClass('fa-exchange');
        $(this).children(':first').toggleClass('fa-check');

        gift_id = $(this).data('id');
        gift_name = $(`#hidden-gift-name${gift_id}`).val();
        gift_image = $(`#hidden-gift-image${gift_id}`).val();
        var gift_price = $(`#hidden-gift-price${gift_id}`).val();
        var category = $(`#hidden-gift-category${gift_id}`).val();

        if ($(this).children(':first').hasClass('fa-check')) {
            // Create comparison item
            var comparison_item = document.createElement('div');
            comparison_item.classList = `
                comparison-item filled d-block bg-whitesmoke rounded-2 
                box-shadow-sm position-relative p-2
            `;
            comparison_item.id = 'comparison-item' + gift_id;
            comparison_item.innerHTML = `
                <span role="button" class="remove-comparison-item position-absolute" data-id="${gift_id}">
                    <i class="bi bi-x-circle-fill text-danger"></i>
                </span>
                <div class="d-flex align-items-center">
                    <img src="dist/images/gifts/${gift_image}" height="80" width="80" alt="" class="rounded-2 me-2">
                    <div class="d-block">
                        <h6 class="text-capitalize my-0">${gift_name}</h6>
                        <p class="text-sm text-muted my-0 py-0 text-capitalize">${category}</p>
                        <h6 class="text-danger text-uppercase font-600">US$${gift_price}</h6>
                    </div>
                </div>
                <a href="javascript:void()" class="stretched-link remove-comparison-item" data-id="${gift_id}"></a>
            `;
            var placeholder_pane = document.querySelector('.comparison-item.empty');
            comparison_pane.replaceChild(comparison_item, placeholder_pane);
        } else {
            removeComparison(gift_id, comparison_pane);
        }
        // Check if comparison-panels are above 1
        comparisons();
    });

    // Removing the comparison item from the comparison pane
    $(document).on('click', '.remove-comparison-item', function(e) {
        e.preventDefault();
        gift_id = $(this).data('id');
        removeComparison(gift_id, comparison_pane);
        $(`#compare-btn${gift_id}`).children(':first').removeClass('fa-check');
        $(`#compare-btn${gift_id}`).children(':first').addClass('fa-exchange');
    });

    /*** Owl Carousel ***/
    // Main carousel
    $('.main-carousel').owlCarousel({
        loop: true,
        margin: 10,
        autoplay: true,
        smartSpeed: 450,
        autoplayHoverPause: true,
        nav: false,
        responsive: {
            0: {
                items: 1
            },
            600: {
                items: 1
            },
            1000: {
                items: 1
            }
        }
    });
    // Gift Categories Carousel
    $('.carousel-autoplay').owlCarousel({
        stagePadding: 50,
        loop: false,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        smartSpeed: 450,
        lazyLoad: true,
        autoplayHoverPause: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        dots: false,
        responsive: {
            0: {
                items: 1
            },
            320: {
                items: 2
            },
            576: {
                items: 2
            },
            768: {
                items: 3
            },
            992: {
                items: 4
            },
            1024: {
                items: 4
            },
            1200: {
                items: 7
            }
        }
    });
    // Related items carousel
    $('.related-items').owlCarousel({
        stagePadding: 50,
        loop: false,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        smartSpeed: 450,
        lazyLoad: true,
        autoplayHoverPause: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        dots: false,
        responsive: {
            0: {
                items: 1
            },
            320: {
                items: 2
            },
            576: {
                items: 2
            },
            768: {
                items: 3
            },
            992: {
                items: 3
            },
            1024: {
                items: 3
            },
            1200: {
                items: 5
            }
        }
    });
    /*** /.Owl Carousel ***/

    /*** Details Page Zooming and Gallery Images ***/
    $('.gallery-img').on('mouseenter', function() {
        $('.gallery-img').not(this).removeClass('active');
        $(this).addClass('active');
        var gallery_img = $(this).attr('src');
        $('#display-img').attr('src', gallery_img);
    });

    $('.gallery-img').on('click', function() {
        $('.gallery-img').not(this).removeClass('active');
        $(this).addClass('active');
        var gallery_img = $(this).attr('src');
        $('#display-img').attr('src', gallery_img);
    });
    /*** /.Details Page Zooming and Gallery Images ***/

    /*** Lazy load images ***/
    var lazyLoadImages;
    if ('IntersectionObserver' in window) {
        lazyLoadImages = document.querySelectorAll('.lazy');
        var imageObserver = new IntersectionObserver(function(entries, observer) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    var image = entry.target;
                    image.src = image.dataset.src;
                    image.classList.remove('lazy');
                    imageObserver.unobserve(image);
                }
            });
        });
        lazyLoadImages.forEach(function(image) {
            imageObserver.observe(image);
        });
    } else {
        var lazyLoadThrottleTimeout;
        lazyLoadImages = document.querySelectorAll('.lazy');

        function lazyLoading() {
            if (lazyLoadThrottleTimeout) {
                clearTimeout(lazyLoadThrottleTimeout);
            }
            lazyLoadThrottleTimeout = setTimeout(() => {
                var scrollTop = window.pageYOffset;
                lazyLoadImages.forEach(function(img) {
                    if (img.offsetTop < window.innerHeight + scrollTop) {
                        img.src = img.dataset.src;
                        img.classList.remove('lazy');
                    }
                });
                if (lazyLoadImages.length == 0) {
                    document.removeEventListener('scroll', lazyLoading);
                    window.removeEventListener('resize', lazyLoading);
                    window.removeEventListener('orientationChange', lazyLoading);
                }
            }, 20);
        }
        document.addEventListener('scroll', lazyLoading);
        window.addEventListener('resize', lazyLoading);
        window.addEventListener('orientationChange', lazyLoading);
    }
    /*** /.Lazy load images ***/

    /*** Gift customizations ***/
    $('.small-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: smallSize,
        animation: true
    });

    $('.medium-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: mediumSize,
        animation: true
    });

    $('.large-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: largeSize,
        animation: true
    });

    $('.xlarge-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: xlargeSize,
        animation: true
    });

    $('.xxlarge-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: xxlargeSize,
        animation: true
    });

    $('.xxxlarge-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: xxxlargeSize,
        animation: true
    });

    $('.4xlarge-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: xxxxlargeSize,
        animation: true
    });

    // User custom text
    $('#gift-custom-text').on('blur', function(e) {
        var custom_text = $(this).val();
        if (custom_text.length > 0) {
            $('#gift-customized').removeClass('d-none');
            $('#user-custom-text').html(custom_text);
            $('#user-custom-gift-text').val(custom_text);
            customizations.custom_text = custom_text;
        } else {
            $('#gift-customized').addClass('d-none');
        }
    });

    // Get available color
    $(document).on('click', '.available-color', function() {
        $('.available-color').not(this).removeClass('active');
        $(this).addClass('active');
        var bg_color = $(this).data('color');
        $('#selected-available-color').html(bg_color);
        var available_color = $(this).data('bg');
        $('#user-custom-color').val(available_color);
        customizations.available_color = available_color;
    });

    // Get custom color
    $(document).on('input', '#custom-color', function() {
        var custom_color = $('#custom-color').val();
        $('#selected-custom-color').text(custom_color);
        customizations.custom_color = custom_color;
    });

    // Get bed size
    $(document).on('click', '.beds', function() {
        $('.beds').not(this).removeClass('active');
        $(this).addClass('active');
        var bed_size = $(this).data('size');
        $('#selected-bed-size').html(bed_size);
        $('#user-custom-bed-size').val(bed_size);
        customizations.bed_size = bed_size;
    });

    // Get shoe size
    $(document).on('click', '.shoe-size', function() {
        $('.shoe-size').not(this).removeClass('active');
        $(this).addClass('active');
        var shoe_size = $(this).data('size');
        $('#selected-shoe-size').html(shoe_size);
        $('#user-custom-shoe-size').val(shoe_size);
        customizations.shoe_size = shoe_size;
    });

    // Get shirt size
    $(document).on('click', '.shirt-size', function() {
        $('.shirt-size').not(this).removeClass('active');
        $(this).addClass('active');
        var shirt_size = $(this).data('size');
        $('#selected-shirt-size').html(shirt_size);
        $('#user-custom-shirt-size').val(shirt_size);
        customizations.shirt_size = shirt_size;
    });

    // Saving custom changes and adding item to cart
    $('#customizing-form').on('submit', function(e) {
        e.preventDefault();
        $('#customizing-form').removeClass('was-validated');
        var action = 'custom-changes';
        // Get custom sizes
        var custom_color = $('#user-custom-color').val();
        var bed_size = $('#user-custom-bed-size').val();
        var shoe_size = $('#user-custom-shoe-size').val();
        var shirt_size = $('#user-custom-shirt-size').val();
        var custom_text = $('#user-custom-gift-text').val();
        var custom_img = '';
        var _token = $('meta[name="csrf-token"]').attr('content');
        var errors = false;

        // For clothing and customizable gifts make sure 
        // the user has chosen the size and color
        if (category_id == 17 || sub_category_id == 41 || sub_category_id == 42) {
            if (custom_color == '' || shirt_size == '') {
                errors = true;
            }
        }

        // For shoes make sure the user has chosen the shoe size
        if (category_id == 18) {
            if (custom_color == '' || shoe_size == '') {
                errors = true;
            }
        }

        // For bed wear make sure the user has chosen the bed size
        if (category_id == 22) {
            if (bed_size == '') {
                errors = true;
            }
        }

        // For customizable gifts make sure the 
        // user has inputted text or uploaded a file
        if (category_id == 25 || category_id == 31) {
            custom_img = $('.gift-custom-img')[0].files[0];
            if (custom_text == '') {
                errors = true;
            }
        }

        // For most gifts make sure that color is chosen
        if (most_gifts.includes(category_id) == true) {
            if (custom_color == '') {
                errors = true;
            }
        }

        // Hide the popover when errors are false
        if (errors == false) {
            // Save user's custom changes to localStorage
            custom_change.push(customizations);
            localStorage.setItem('customized-gifts', JSON.stringify(custom_change));
            // Hide popover 
            $('.add-to-cart').popover('hide');
        } else {
            $('.add-to-cart').popover('show');
        }
    });
    /*** /.Gift customizations ***/
});