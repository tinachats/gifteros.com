// Date and time functions
var today = new Date();
var hours = ("0" + today.getHours()).slice(-2);
var date = ("0" + today.getDate()).slice(-2);
var mnth = ("0" + today.getMonth()).slice(-2);
var year = today.getFullYear();
var day = new Array();
day[0] = 'Sunday';
day[1] = 'Monday';
day[2] = 'Tuesday';
day[3] = 'Wednesday';
day[4] = 'Thursday';
day[5] = 'Friday';
day[6] = 'Saturday';

var d = day[today.getDay()];

var month = new Array();
month[0] = 'January';
month[1] = 'February';
month[2] = 'March';
month[3] = 'April';
month[4] = 'May';
month[5] = 'June';
month[6] = 'July';
month[7] = 'August';
month[8] = 'September';
month[9] = 'October';
month[10] = 'November';
month[11] = 'December';

// Owl Carousel navigation icons
const prevIcon = '<img src="dist/images/app/circled-previous.svg" class="prev-icon" alt="Prev" height="40" width="40">';
const nextIcon = '<img src="dist/images/app/circled-next.svg" class="next-icon" alt="Next" height="40" width="40">';

// Alert messages
var message = '';

// Array of acceptible files
var acceptible_files = ['gif', 'jfif', 'png', 'jpg', 'jpeg'];

// Cart details
var gift_id, post_id, user_id, gift_name;
var gift_quantity = 1;
var gift_ids = [];

// Gift that have to be checked to see if color is chosen
var most_gifts = [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 21, 26, 27, 28, 30, 33, 35];

// Saving custom changes  to localStorage
var custom_change = [];
var customizations = new Object();

// Save the gift_id in the customization object
customizations.gift_id = gift_id;

// Toggle sign-in form
function showLoginForm() {
    $('.user-menu').toggleClass('show');
}

// User greeting
(function greeting() {
    var greeting, icon;
    if (hours < 12) {
        greeting = 'Good morning!';
        icon = 'sunrise';
    } else if (hours < 18) {
        greeting = 'Good afternoon!';
        icon = "noon";
    } else {
        greeting = 'Good evening!'
        icon = 'cloudy-night';
    }
    $('.user-greeting').html(greeting);
    $('.greeting-icon').attr('src', `dist/images/greeting-icons/${icon}.svg`);
})();

// RateYo Star Rating
function starRating(el, rating, size) {
    $(el).rateYo({
        rating: rating,
        starWidth: `${size}px`,
        spacing: '5px',
        readOnly: true
    });
}
// Force numeric input
function forceNumeric() {
    var input = $(this);
    input.val(input.val().replace(/[^\d+(\.\d{1,2})?$]+/, ''));
}

// Available colors
function availableColors() {
    var custom_colors = icon_color = '';
    var colors = [{
            'bg_color': 'bg-yellow-gold',
            'title': 'Yellow Gold'
        },
        {
            'bg_color': 'bg-orange-bright',
            'title': 'Bright Orange'
        },
        {
            'bg_color': 'bg-brick-red',
            'title': 'Brick Red'
        },
        {
            'bg_color': 'bg-red',
            'title': 'Red'
        },
        {
            'bg_color': 'bg-aqua',
            'title': 'Aqua'
        },
        {
            'bg_color': 'bg-orchid',
            'title': 'Violet'
        },
        {
            'bg_color': 'bg-default-blue',
            'title': 'Blue'
        },
        {
            'bg_color': 'bg-navy-blue',
            'title': 'Navy Blue'
        },
        {
            'bg_color': 'bg-turf-green',
            'title': 'Turf Green'
        },
        {
            'bg_color': 'bg-green',
            'title': 'Dark Green'
        },
        {
            'bg_color': 'bg-yellow-gold',
            'title': 'Yellow Gold'
        },
        {
            'bg_color': 'bg-dark',
            'title': 'Black'
        },
        {
            'bg_color': 'bg-brown',
            'title': 'Brown'
        },
        {
            'bg_color': 'bg-grey',
            'title': 'Grey'
        },
        {
            'bg_color': 'bg-white',
            'title': 'White'
        }
    ];
    colors.forEach(color => {
        if (color.bg_color == 'bg-white' || color.bg_color == 'bg-grey') {
            icon_color = 'text-success';
        } else {
            icon_color = 'text-white';
        }
        custom_colors += `
            <!-- Custom Color Picker -->
            <div class="custom-color available-color shadow-sm" id="${color.bg_color}" data-color="${color.title}" title="${color.title}">
                <div class="color-inset ${color.bg_color}">
                    <i class="${icon_color} material-icons color-selected-icon">done</i>
                </div>
            </div>
            <!-- Custom Color Picker -->
        `;
    });
    $('.available-colors').html(custom_colors);
}

// Shoe sizes
function shoeSizes(gift_id) {
    var output = '';
    for (var i = 35; i < 49; i++) {
        output += `
            <div class="d-grid shoe-size custom-option shoe-size" id="${i}${gift_id}" data-size="${i}">
                <div class="m-auto">
                    <div class="m-auto">
                        <span class="size">${i}</span>
                    </div>
                </div>
            </div> 
        `;
    }
    $('.shoe-sizes').html(output);
}

// Shirt sizes
function shirtSizes(gift_id) {
    var output = '';
    sizes = [
        { 'size': 'S' },
        { 'size': 'M' },
        { 'size': 'L' },
        { 'size': 'XL' },
        { 'size': 'XXL' },
        { 'size': 'XXXL' },
        { 'size': '4XL' }
    ];
    sizes.forEach(size => {
        output += `
            <div class="d-grid shirt-size custom-option ${size.size}" id="${size.size}${gift_id}" data-size="${size.size}">
                <div class="m-auto">
                    <span class="size">${size.size}</span>
                </div>
            </div>
        `;
    });
    $('.shirt-sizes').html(output);
}

// Bed sizes
function bedSizes() {
    var output = '';
    var bed_sizes = [
        { 'size': 'twin' },
        { 'size': 'twin-xl' },
        { 'size': 'double' },
        { 'size': 'queen' },
        { 'size': 'king' },
        { 'size': 's-king' }
    ];
    bed_sizes.forEach(bed_size => {
        output += `
            <div class="d-grid beds custom-option" id="${bed_size.size}${gift_id}" data-size="${bed_size.size}">
                <div class="m-auto">
                    <span class="size">${bed_size.size}</span>
                </div>
            </div>
        `;
    });
    $('.bed-sizes').html(output);
}

// Custom options
function customOptions(gift_id) {
    availableColors();
    shirtSizes(gift_id);
    bedSizes();
    shoeSizes(gift_id);
    ratingFilterBtns();
}

// Review Filter Buttons
function ratingFilterBtns() {
    var output = '';
    for (var i = 5; i > 0; i--) {
        output += `
            <div type="button" class="button btn btn-outline-secondary btn-sm filter-reviews filter-rating text-sm" data-id="${i}">
                ${i}<span class="text-gold">&starf;</span>
            </div>
        `;
    }
    $('#rating-filter-buttons').html(output);
}

/*** Preloaders ***/
function productPreloaders(limit) {
    var output = '';
    for (var i = 0; i < limit; i++) {
        output += `
            <!-- Product Placeholder Card -->
            <div class="card placeholder-card bg-whitesmoke rounded-2 box-shadow-sm">
                <div class="overlay-placeholder"></div>
                <div class="img-wrapper-placeholder">
                    <div class="badge customize-ribbon d-flex align-items-center placeholder-label rounded-end"></div>
                    <div class="placeholder-img"></div>
                </div>
                <hr class="grid-view-hr my-0 py-0">
                <div class="placeholder-card-content">
                    <div class="card-body placeholder-body m-0 p-0 rounded-bottom-2">
                        <div class="content-placeholder title-placeholder mt-1 ms-2"></div>
                        <div class="content-placeholder category-placeholder my-1 ms-2"></div>
                        <div class="d-flex align-items-center">
                            <div class="content-placeholder rating-placeholder ms-2"></div>
                        </div>
                        <div class="content-placeholder description-placeholder mt-2 mb-1 mx-2"></div>
                        <div class="content-placeholder half-description-placeholder ms-2"></div>
                        <div class="d-flex align-items-center justify-content-between placeholder-pricing-block mt-2">
                            <div class="content-placeholder price-placeholder me-2 ms-2"></div>
                            <div class="content-placeholder before-price-placeholder me-2"></div>
                        </div>
                        <div class="text-center w-100 mx-0 px-0 mb-1">
                            <div class="btn-group btn-group-sm mt-0 pt-0 btn-group-placeholder pulse">
                                <button class="btn btn-sm btn-cart-placeholder rounded-start"></button>
                                <button class="btn btn-sm compare-btn-placeholder rounded-end"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.Product Placeholder Card -->
        `;
    }
    $('#preloaders').html(output);
}
/*** /.Preloaders ***/

/*** Alerts ***/
// General info alert
function infoAlert(message) {
    iziToast.show({
        theme: 'dark',
        timeout: 5000,
        closeOnClick: true,
        close: false,
        progressBar: false,
        backgroundColor: 'var(--dark-blue)',
        icon: 'bi bi-info-circle text-white-inverse',
        message: message,
        messageColor: 'var(--white-inverse)',
        position: 'topCenter'
    });
}

// Sweetalert2 success
function swalSuccess(message) {
    Swal.fire(
        '',
        message,
        'success',
    );
}

// General success alert message
function successAlert(message) {
    iziToast.show({
        theme: 'dark',
        timeout: 2000,
        closeOnClick: true,
        overlay: false,
        close: false,
        backgroundColor: 'var(--success)',
        progressBar: false,
        icon: 'bi bi-check2-circle text-light',
        message: message,
        messageColor: '#fff',
        position: 'topCenter'
    });
}

// Success alert message with gift image
function giftSuccessAlert(gift_image, message) {
    iziToast.show({
        animateInside: true,
        theme: 'dark',
        timeout: 3000,
        closeOnClick: true,
        overlay: false,
        close: false,
        backgroundColor: 'var(--success)',
        progressBar: false,
        icon: 'bi bi-check2-circle text-light',
        image: '/storage/gifts/' + gift_image,
        imageWidth: 60,
        message: message,
        messageColor: '#fff',
        position: 'topCenter'
    });
}

// General warning alert
function warningAlert(message) {
    iziToast.warning({
        theme: 'dark',
        timeout: 5000,
        closeOnClick: true,
        close: false,
        progressBar: false,
        backgroundColor: 'var(--warning)',
        icon: 'bi bi-exclamation-circle text-dark',
        message: message,
        messageColor: '#000',
        position: 'topCenter'
    });
}
/*** /.Alerts ***/


/*** Details Page Actions ***/

// Fetch all gift customized details
function customizationDetails(gift_id) {
    let data = localStorage.getItem('customized-gifts');
    var custom_color = custom_text = bed_size = '';
    var shirt_size = shoe_size = '';
    if (data != null) {
        var custom_changes = JSON.parse(localStorage.getItem('customized-gifts'));
        for (var i = 0; i < custom_changes.length; i++) {
            if (custom_changes[i].gift_id == gift_id) {
                custom_color = custom_changes[i].custom_color;
                bed_size = custom_changes[i].bed_size;
                shirt_size = custom_changes[i].shirt_size;
                shoe_size = custom_changes[i].shoe_size;
                custom_text = custom_changes[i].custom_text;
            }
        }
        // Show active available color on the page
        $('.available-color').not(this).removeClass('active');
        $(`#${available_color}${gift_id}`).addClass('active');

        // Show active custom-color on the page
        $('.custom-color').not(this).removeClass('active');
        $(`#${custom_color}${gift_id}`).addClass('active');

        // Show active bed-size on the page
        $('.beds').not(this).removeClass('active');
        $(`#${bed_size}${gift_id}`).addClass('active');

        // Show active shoe-size on the page
        $('.shoe-size').not(this).removeClass('active');
        $(`#${shoe_size}${gift_id}`).addClass('active');

        // Show active shirt-size on the page
        $('.shirt-size').not(this).removeClass('active');
        $(`#${shirt_size}${gift_id}`).addClass('active');

        // Show custom text
        $('#gift-custom-text').text(custom_text);
        $('#user-custom-gift-text').val(custom_text);
    } else {
        $('.shirt-size').removeClass('active');
        $('.custom-option').removeClass('active');
        $('.beds').removeClass('active');
    }
}

function smallSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">92cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">64cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">43cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">17cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function mediumSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">96cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">65cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">44cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">18cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function largeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">100cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">67cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">46cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">19cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function xlargeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">104cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">69cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">47cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">20cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function xxlargeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">108cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">71cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">50cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">21cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function xxxlargeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">110cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">73cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">54cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">22cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

function xxxxlargeSize() {
    var content = `
        <h6 class="text-center font-600 mb-0">Manufacturer's Size</h6>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Chest Width</p>
                        </div>
                        <p class="ml-auto">112cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Length</p>
                        </div>
                        <p class="ml-auto">75cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Shoulder</p>
                        </div>
                        <p class="ml-auto">57cm</p>
                    </div>
                </div>
                <div class="col-12">
                    <div class="d-flex align-items-center my-1 p-2">
                        <div class="bg-light">
                            <p class="my-0">Sleeve Length</p>
                        </div>
                        <p class="ml-auto">23cm</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    return content;
}

// Diable the submit button if there's no review text
function emptyReview(obj) {
    var review = obj.value;
    if (review.length > 0) {
        $('#submit-review').attr('disabled', false);
    } else {
        $('#submit-review').attr('disabled', true);
    }
}

// Rating category
function ratingCategory(rating) {
    var output = '';
    if (rating >= 0 && rating < 1.5) {
        output = 'Very Bad';
    } else if (rating >= 1.5 && rating < 2.5) {
        output = 'Bad';
    } else if (rating >= 2.5 && rating < 3.5) {
        output = 'Fair';
    } else if (rating >= 3.5 && rating < 4.5) {
        output = 'Good';
    } else {
        output = 'Awesome';
    }
    return output;
}

function imageZoom(imgID, resultID) {
    var img, lens, result, cx, cy;
    img = document.getElementById(imgID);
    result = document.getElementById(resultID);

    // Create zooming lens
    lens = document.createElement('div');
    lens.setAttribute('class', 'img-zoom-lens');

    // Insert lens
    img.parentElement.insertBefore(lens, img);

    // Claculate the ratio between the result-div and the lens
    cx = result.offsetWidth / lens.offsetWidth;
    cy = result.offsetHeight / lens.offsetHeight;

    // Set background properties for the result div
    result.style.backgroundImage = 'url("' + img.src + '")';
    result.style.backgroundSize = (img.width * cx) + 'px' + (img.height * cy) + 'px';

    // Execute the function when someone moves the cursor over the image, or the lens
    lens.addEventListener('mousemove', moveLens);

    // For touch screens
    img.addEventListener('touchmove', moveLens);
    lens.addEventListener('touchmove', moveLens);

    function moveLens(e) {
        var pos, x, y;

        // Prevent any other actions that may occur when moving
        // Over the image 
        e.preventDefault();

        // Get the cursor's x and y positions 
        pos = getCursorPos(e);

        // Calculate the position of the lens 
        x = pos.x - (lens.offsetWidth / 2);
        y = pos.y - (lens.offsetHeight / 2);

        // Prevent the lens from being positioned outside the image 
        if (x > img.width - lens.offsetHeight) {
            x = img.width - lens.offsetWidth;
        }

        if (x < 0) {
            x = 0;
        }

        if (y > img.height - lens.offsetHeight) {
            y = img.height - lens.offsetHeight;
        }

        if (y < 0) {
            y = 0;
        }

        // Set the position of the lens 
        result.style.backgroundPosition = '-' + (x + cx) + 'px -' + (y + cy) + 'px';
    }

    function getCursorPos(e) {
        var a, x = y = 0;
        e = e || window.event;

        // Get the x and y positions of the image
        a = img.getBoundingClientReact();

        // Calculate the cursor's x and y coordinates relative to the image 
        x = e.pageX - a.left;
        y = e.pageY - a.top;

        // Consider any page scrolling 
        x = x - window.pageXOffset;
        y = y - window.pageYOffset;
        return {
            x: x,
            y: y
        };
    }
}
/*** /.Details Page Actions ***/

$(function() {
    // Enable popovers and tooltips
    $('[data-bs-toggle="popover"]').popover();
    $('[data-bs-toggle="tooltip"]').tooltip();

    // Load material-icons
    $('.material-icons').show();

    // Hide the progress gradient when page is fully loaded
    $('.line').hide();

    //Alert Tone
    function alert_tone() {
        var tone = '<audio autoplay="true"><source src="../tones/alert.wav"></audio>';
        $('body').append(tone);
    }

    // Toggle scroll to top button
    $(window).on('scroll', function() {
        if ($(this).scrollTop() - 200 > 0) {
            // Show button
            $('.to-top').stop().addClass('show');
        } else {
            // Hide button
            $('.to-top').stop().removeClass('show');
        }
    });

    // Click to toggle floating-action-buttons
    $(document).on('click', '.toggle-actions', function() {
        $('.action-btn').toggleClass('show');
    });

    // Force numeric values on text inputs
    $('body').on('keyup', '.number-input', forceNumeric);

    // Gift search suggestions
    $(document).on('keyup', '#search', function() {
        let search = $(this).val();
        let val = search.length;
        if (val > 0) {
            $(this).addClass('expanded');
            $('.zoom-out-section').css('z-index', -1);
            $('.search-list').removeClass('d-none');
            $.ajax({
                url: '/search',
                method: 'get',
                data: {
                    search: search
                },
                dataType: 'json',
                success: function(data) {
                    $('.search-list').html(data.results);
                    userCurrency();
                }
            });
        } else {
            $(this).removeClass('expanded');
            $('.zoom-out-section').css('z-index', 'inherit');
            $('.line').css('display', 'none');
            $('.search-list').addClass('d-none');
        }
    });

    // Close the search list if not in focus
    $(document).on('mouseup', function(e) {
        var search_list = $('.search-list');
        if (!search_list.is(e.target) && search_list.has(e.target).length == 0) {
            $('.search-list').addClass('d-none');
            $('.zoom-out-section').css('z-index', 'inherit');
            $('#search-form')[0].reset();
            $('#search').removeClass('expanded');
        }
    });

    // Do not close app-menu when clicked inside
    $('.app-menu').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
    });

    // Close sign-in form if not in focus
    $(document).on('mouseup', function(e) {
        var login_form = $('.user-menu');
        if (!login_form.is(e.target) && login_form.has(e.target).length == 0) {
            $('.user-menu').removeClass('show');
        }
    });

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.getElementsByClassName('needs-validation');
    // Loop over them and prevent submission
    Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });

    //Get the button
    $(window).on('scroll', function() {
        if ($(document).height() >= $(window).height()) {
            $('#scroll-top').css('display', 'block');
        } else {
            $('#scroll-top').css('display', 'none');
        }
    });

    // Toggle the active class on the nav-icon
    $(document).on('click', function(e) {
        var icon_links = $('.icon-link');
        if (!icon_links.is(e.target) && icon_links.has(e.target).length == 0) {
            icon_links.removeClass('active');
        }
    });

    // Show the mega-menu on mouse-enter
    $('.mega-item').on('mouseenter', function(e) {
        $('.mega-menu').addClass('show');
    });

    // Hide the mega-menu on mouse-leave
    $('.mega-menu').on('mouseleave', function(e) {
        $('.mega-menu').removeClass('show');
    });

    // Choose currency
    $('.currency-option').on('click', function() {
        var currency_flag = $(this).children(':first').attr('src');
        var currency = $(this).children(':last').attr('id');
        var total = $(this).children(':last').data('total')
        $('#currency-flag').attr('src', currency_flag);
        $('#currency-total').html(total);
    });

    // Toggle active class on review filters 
    $(document).on('click', '.filter-reviews', function() {
        $('.filter-reviews').not(this).removeClass('active');
        $(this).addClass('active');
    });


    // Show selected filter in dropdown button
    $('.review-filter-item').on('click', function() {
        var rating = $(this).data('id');
        if (rating == 'Most relevant') {
            $('#most-relevant-icon').removeClass('d-none');
            $('#newest-icon').addClass('d-none');
        } else {
            $('#most-relevant-icon').addClass('d-none');
            $('#newest-icon').removeClass('d-none');
        }
        $('#sort-reviews').text(rating);
    });

    // Toggle harassment-type on click
    $('.report-radio-btn').on('click', function() {
        var report_type = $(this).val();
        if (report_type == 'harassment') {
            $('#harassment-type').removeClass('d-none');
        } else {
            $('#harassment-type').addClass('d-none');
        }
    });

    /*** Owl Carousel ***/
    // Main carousel
    $('.main-carousel').owlCarousel({
        loop: true,
        margin: 10,
        autoplay: true,
        smartSpeed: 450,
        autoplayHoverPause: true,
        responsive: {
            0: {
                items: 1
            },
            600: {
                items: 1
            },
            1000: {
                items: 1
            }
        }
    });
    // Gift Caterories Carousel
    $('.carousel-autoplay').owlCarousel({
        stagePadding: 50,
        loop: false,
        margin: 10,
        navRewind: false,
        stagePadding: true,
        smartSpeed: 450,
        lazyLoad: true,
        autoplayHoverPause: true,
        nav: true,
        navText: [
            prevIcon,
            nextIcon
        ],
        dots: false,
        responsive: {
            0: {
                items: 1
            },
            320: {
                items: 2
            },
            576: {
                items: 2
            },
            768: {
                items: 3
            },
            992: {
                items: 4
            },
            1024: {
                items: 4
            },
            1200: {
                items: 7
            }
        }
    });
    /*** /.Owl Carousel ***/

    /*** Details Page Zooming and Gallery Images ***/
    $('.gallery-img').on('mouseenter', function() {
        $('.gallery-img').not(this).removeClass('active');
        $(this).addClass('active');
        var gallery_img = $(this).attr('src');
        $('#display-img').attr('src', gallery_img);
    });

    $('.gallery-img').on('click', function() {
        $('.gallery-img').not(this).removeClass('active');
        $(this).addClass('active');
        var gallery_img = $(this).attr('src');
        $('#display-img').attr('src', gallery_img);
    });
    /*** /.Details Page Zooming and Gallery Images ***/

    /*** Lazy load images ***/
    var lazyLoadImages;
    if ('IntersectionObserver' in window) {
        lazyLoadImages = document.querySelectorAll('.lazy');
        var imageObserver = new IntersectionObserver(function(entries, observer) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    var image = entry.target;
                    image.src = image.dataset.src;
                    image.classList.remove('lazy');
                    imageObserver.unobserve(image);
                }
            });
        });
        lazyLoadImages.forEach(function(image) {
            imageObserver.observe(image);
        });
    } else {
        var lazyLoadThrottleTimeout;
        lazyLoadImages = document.querySelectorAll('.lazy');

        function lazyLoading() {
            if (lazyLoadThrottleTimeout) {
                clearTimeout(lazyLoadThrottleTimeout);
            }
            lazyLoadThrottleTimeout = setTimeout(() => {
                var scrollTop = window.pageYOffset;
                lazyLoadImages.forEach(function(img) {
                    if (img.offsetTop < window.innerHeight + scrollTop) {
                        img.src = img.dataset.src;
                        img.classList.remove('lazy');
                    }
                });
                if (lazyLoadImages.length == 0) {
                    document.removeEventListener('scroll', lazyLoading);
                    window.removeEventListener('resize', lazyLoading);
                    window.removeEventListener('orientationChange', lazyLoading);
                }
            }, 20);
        }
        document.addEventListener('scroll', lazyLoading);
        window.addEventListener('resize', lazyLoading);
        window.addEventListener('orientationChange', lazyLoading);
    }
    /*** /.Lazy load images ***/

    /*** Gift customizations ***/
    $('.small-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: smallSize,
        animation: true
    });

    $('.medium-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: mediumSize,
        animation: true
    });

    $('.large-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: largeSize,
        animation: true
    });

    $('.xlarge-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: xlargeSize,
        animation: true
    });

    $('.xxlarge-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: xxlargeSize,
        animation: true
    });

    $('.xxxlarge-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: xxxlargeSize,
        animation: true
    });

    $('.4xlarge-size').popover({
        html: true,
        container: 'body',
        placement: 'bottom',
        trigger: 'hover',
        content: xxxxlargeSize,
        animation: true
    });

    // User custom text
    $('#gift-custom-text').on('blur', function(e) {
        var custom_text = $(this).val();
        if (custom_text.length > 0) {
            $('#gift-customized').removeClass('d-none');
            $('#user-custom-text').html(custom_text);
            $('#user-custom-gift-text').val(custom_text);
            customizations.custom_text = custom_text;
        } else {
            $('#gift-customized').addClass('d-none');
        }
    });

    // Get available color
    $(document).on('click', '.available-color', function() {
        $('.available-color').not(this).removeClass('active');
        $(this).addClass('active');
        var bg_color = $(this).data('color');
        $('#selected-available-color').html(bg_color);
        var available_color = $(this).data('bg');
        $('#user-custom-color').val(available_color);
        customizations.available_color = available_color;
    });

    // Get custom color
    $(document).on('input', '#custom-color', function() {
        var custom_color = $('#custom-color').val();
        $('#selected-custom-color').text(custom_color);
        customizations.custom_color = custom_color;
    });

    // Get bed size
    $(document).on('click', '.beds', function() {
        $('.beds').not(this).removeClass('active');
        $(this).addClass('active');
        var bed_size = $(this).data('size');
        $('#selected-bed-size').html(bed_size);
        $('#user-custom-bed-size').val(bed_size);
        customizations.bed_size = bed_size;
    });

    // Get shoe size
    $(document).on('click', '.shoe-size', function() {
        $('.shoe-size').not(this).removeClass('active');
        $(this).addClass('active');
        var shoe_size = $(this).data('size');
        $('#selected-shoe-size').html(shoe_size);
        $('#user-custom-shoe-size').val(shoe_size);
        customizations.shoe_size = shoe_size;
    });

    // Get shirt size
    $(document).on('click', '.shirt-size', function() {
        $('.shirt-size').not(this).removeClass('active');
        $(this).addClass('active');
        var shirt_size = $(this).data('size');
        $('#selected-shirt-size').html(shirt_size);
        $('#user-custom-shirt-size').val(shirt_size);
        customizations.shirt_size = shirt_size;
    });

    // Saving custom changes and adding item to cart
    $('#customizing-form').on('submit', function(e) {
        e.preventDefault();
        $('#customizing-form').removeClass('was-validated');
        var action = 'custom-changes';
        // Get custom sizes
        var custom_color = $('#user-custom-color').val();
        var bed_size = $('#user-custom-bed-size').val();
        var shoe_size = $('#user-custom-shoe-size').val();
        var shirt_size = $('#user-custom-shirt-size').val();
        var custom_text = $('#user-custom-gift-text').val();
        var custom_img = '';
        var _token = $('meta[name="csrf-token"]').attr('content');
        var errors = false;

        // For clothing and customizable gifts make sure 
        // the user has chosen the size and color
        if (category_id == 17 || sub_category_id == 41 || sub_category_id == 42) {
            if (custom_color == '' || shirt_size == '') {
                errors = true;
            }
        }

        // For shoes make sure the user has chosen the shoe size
        if (category_id == 18) {
            if (custom_color == '' || shoe_size == '') {
                errors = true;
            }
        }

        // For bed wear make sure the user has chosen the bed size
        if (category_id == 22) {
            if (bed_size == '') {
                errors = true;
            }
        }

        // For customizable gifts make sure the 
        // user has inputted text or uploaded a file
        if (category_id == 25 || category_id == 31) {
            custom_img = $('.gift-custom-img')[0].files[0];
            if (custom_text == '') {
                errors = true;
            }
        }

        // For most gifts make sure that color is chosen
        if (most_gifts.includes(category_id) == true) {
            if (custom_color == '') {
                errors = true;
            }
        }

        // Hide the popover when errors are false
        if (errors == false) {
            // Save user's custom changes to localStorage
            custom_change.push(customizations);
            localStorage.setItem('customized-gifts', JSON.stringify(custom_change));
            // Hide popover 
            $('.add-to-cart').popover('hide');
        } else {
            $('.add-to-cart').popover('show');
        }
    });
    /*** /.Gift customizations ***/

    // Gift Rating
    $("#user-rating").rateYo({
        onSet: function(rating, rateYoInstance) {
            $(this).next().text(ratingCategory(rating));
            $('#star-rating').val(rating);
        },
        normalFill: "#A0A0A0",
        maxValue: 5,
        starWidth: "20px",
        spacing: "10px"
    });
});